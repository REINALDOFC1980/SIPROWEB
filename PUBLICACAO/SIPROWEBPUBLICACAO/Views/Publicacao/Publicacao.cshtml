@model SIPROSHAREDPUBLICACAO.Model.PublicacaoModel

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2 class="m-b-xxs">Publicação do processo.</h2>
        <small>Processos prontos para serem publicado em lotes.</small>
    </div>
    <div class="col-lg-2">
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div id="Div_Publicar">
        @await Html.PartialAsync("_Qtd_Publicar")
    </div>
</div>


<div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">

    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>

                <i class="fa fa-tags modal-icon"></i>
                <h2 class="modal-title">Lote Gerado: <strong>LT1/2025</strong>     </h2>
                <br />
                <button type="button" class="btn btn-primary btn-xs text-center"><i class="fa fa-print"></i> Imprimir DOM </button>


            </div>


            <div class="modal-body">


                <form id="form_distribuicao">

                    <div class="form-group row">
                        <label class="col-lg-4 col-form-label text-right">Lote:</label>
                        <div class="col-lg-8">
                            <div class="input-group">
                                <input placeholder="" id="PRT_LOTE" type="text" class="form-control form-control-sm" readonly>
                                <span class="input-group-append">
                                    <button type="button" class="btn btn-sm btn-danger">
                                        <i class="fa fa-trash-o"></i> Excluir Lote
                                    </button>
                                </span>
                            </div>

                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-4 col-form-label text-right">Responsável:</label>
                        <div class="col-lg-8"><input type="text" class="form-control" id="PRT_USU_PUBLICACAO"  readonly></div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-4 col-form-label text-right">Date de Geração:</label>
                        <div class="col-lg-8"><input type="text" class="form-control" id="PRT_DT_LOTE" readonly></div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-4 col-form-label text-right">Quantidade:</label>
                        <div class="col-lg-8"><input type="text" class="form-control" id="PRT_PUBLICACAO_QTD" readonly></div>
                    </div>

                    <hr />

                    <div class="form-group row">
                        <label class="col-lg-4 col-form-label text-right">Número DOM:</label>
                        <div class="col-lg-8"><input type="text" class="form-control" id="PRT_PUBLICACAO_DOM"></div>
                    </div>
                    <div class="form-group row">
                        <label class="col-lg-4 col-form-label text-right">Data de Publicação:</label>
                        <div class="col-lg-8"><input type="text" class="form-control" id="PRT_DT_PUBLICACAO" data-mask="99/99/9999"></div>
                    </div>

                </form>

                <div class="modal-footer">
                    <br />
                    <button type="button" class="btn btn-block btn-primary " data-dismiss="modal"><i class="fa fa-print"></i> Gravar Publicação do DOM </button>
                </div>


            </div>
        </div>
    </div>
</div>





<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>


<script type="module">

    $(document).on('click', '.gerarlote', function (e) {

        Notiflix.Confirm.Show(
            'Aviso!',
            'Tem certeza que deseja gera um lote?',
            'Sim',
            'Não',
            async function okCb() {
                Notiflix.Loading.Standard('Aguarde...');
                try {
                    const response = await fetch('@Url.Action("GerarLote", "publicacao")', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {

                        Notiflix.Loading.Remove();
                        throw new Error(`Erro na requisição: ${response.statusText}`);
                    }

                    Notiflix.Loading.Remove();
                    const html = await response.text();
                    $('#Div_Publicar').html(html);

                } catch (error) {
                    console.error("Erro ao gerar lote:", error);
                }
            },
            function cancelCb() {
                Notiflix.Loading.Remove();
            },
            {

            }
        );

    });






    //Buscar os dados para exibir na model de Area Trabalho
    $(document).on('click', '.lote', function (e) {

        e.preventDefault();
        var valor = $(this).data('id');


        $.ajax({
            url: '@Url.Action("Buscar_Lote", "Publicacao")',
            type: 'GET',
            data: { lote: valor },
            success: function (data) {

                if (data.error == true) {
                    Notiflix.Notify.Failure('Erro ao realizar a operação.');
                    return false;
                }

                if (Array.isArray(data.publicacaoModel) && data.publicacaoModel.length > 0) {
                    let publicacao = data.publicacaoModel[0];
                    $('#PRT_LOTE').val(publicacao.prt_lote);
                    $('#PRT_USU_PUBLICACAO').val(publicacao.prt_publicacao_dom);
                    $('#PRT_DT_LOTE').val(publicacao.prt_dt_lote);
                    $('#PRT_PUBLICACAO_QTD').val(publicacao.prt_publicacao_qtd);
                } else {
                    console.warn("Nenhum dado encontrado");
                }

                $('#myModal').modal('show');

            },
            error: function (xhr, status, error) {
                // Lida com erros, se houver
                console.log(xhr.responseText);
            }
        });
    });




</script>